/*
 pogomap 2016-08-13 
*/

"use strict";function loadRawData(){return $.ajax({url:"raw_data",type:"GET",data:{pokemon:!1,pokestops:!1,gyms:!1,scanned:!1,seen:!0,duration:document.getElementById("duration").options[document.getElementById("duration").selectedIndex].value},dataType:"json",beforeSend:function a(){return!rawDataIsLoading&&void(rawDataIsLoading=!0)},complete:function a(){rawDataIsLoading=!1}})}function addElement(a,b){jQuery("<div/>",{id:"seen_"+a,class:"item"}).appendTo("#seen_container"),jQuery("<div/>",{id:"seen_"+a+"_base",class:"container"}).appendTo("#seen_"+a);var c=jQuery("<div/>",{class:"image"}).appendTo("#seen_"+a+"_base");jQuery("<img/>",{src:"static/icons/"+a+".png",alt:"Image for Pokemon #"+a}).appendTo(c);var d=jQuery("<div/>",{class:"info"}).appendTo("#seen_"+a+"_base");jQuery("<div/>",{id:"name_"+a,class:"name"}).appendTo(d),jQuery("<a/>",{id:"link_"+a,href:"http://www.pokemon.com/us/pokedex/"+a,target:"_blank",title:"View in Pokedex",text:b}).appendTo("#name_"+a),jQuery("<div/>",{id:"seen_"+a+"_details",class:"details"}).appendTo("#seen_"+a),jQuery("<div/>",{id:"count_"+a,class:"seen"}).appendTo("#seen_"+a+"_details"),jQuery("<div/>",{id:"lastseen_"+a,class:"lastseen"}).appendTo("#seen_"+a+"_details"),jQuery("<div/>",{id:"location_"+a,class:"location"}).appendTo("#seen_"+a+"_details"),jQuery("<a/>",{href:"javascript:showOverlay("+a+");",text:"All Locations"}).appendTo("#seen_"+a+"_details")}function processSeen(a){var b,c=a.total,d=[];for(a.pokemon.sort(function(a,b){var c=document.getElementById("sort"),d=document.getElementById("order");if("desc"===d.options[d.selectedIndex].value){var e=b;b=a,a=e}return"id"===c.options[c.selectedIndex].value?a.pokemon_id-b.pokemon_id:"name"===c.options[c.selectedIndex].value?a.pokemon_name.toLowerCase()<b.pokemon_name.toLowerCase()?1:a.pokemon_name.toLowerCase()>b.pokemon_name.toLowerCase()?-1:0:a.count===b.count?b.pokemon_id-a.pokemon_id:a.count-b.count}),b=a.pokemon.length-1;b>=0;b--){var e=a.pokemon[b],f=(e.count/c*100).toFixed(2),g=new Date(e.disappear_time);g=g.getHours()+":"+("0"+g.getMinutes()).slice(-2)+":"+("0"+g.getSeconds()).slice(-2)+" "+g.getDate()+" "+monthArray[g.getMonth()]+" "+g.getFullYear();var h=(1*e.latitude).toFixed(7)+", "+(1*e.longitude).toFixed(7);$("#seen_"+e.pokemon_id).length||addElement(e.pokemon_id,e.pokemon_name),$("#count_"+e.pokemon_id).html("<strong>Seen:</strong> "+e.count.toLocaleString()+" ("+f+"%)"),$("#lastseen_"+e.pokemon_id).html("<strong>Last Seen:</strong> "+g),$("#location_"+e.pokemon_id).html("<strong>Location:</strong> "+h),$("#seen_"+e.pokemon_id).show(),document.getElementById("seen_container").insertBefore(document.getElementById("seen_"+e.pokemon_id),document.getElementById("seen_container").childNodes[0]),d.push(e.pokemon_id)}for(b=1;b<=totalPokemon;b++)d.indexOf(b)<0&&$("#seen_"+b).hide();document.getElementById("seen_total").innerHTML="Total: "+c.toLocaleString()}function updateMap(a){var b=document.getElementById("duration"),c="Pokemon Seen in "+b.options[b.selectedIndex].text;$("#seen_header").html()!==c&&($("#seen_container").hide(),$("#loading").show(),$("#seen_header").html(""),$("#seen_total").html("")),loadRawData().done(function(a){processSeen(a.seen),$("#seen_header").html()!==c&&($("#seen_header").html(c),$("#loading").hide(),$("#seen_container").show())})}function loadDetails(){return $.ajax({url:"raw_data",type:"GET",data:{pokemon:!1,pokestops:!1,gyms:!1,scanned:!1,appearances:!0,pokemonid:pokemonid,last:lastappearance},dataType:"json",beforeSend:function a(){return!detailsLoading&&void(detailsLoading=!0)},complete:function a(){detailsLoading=!1}})}function showTimes(a){var b=a.position.lat().toFixed(7)+"_"+a.position.lng().toFixed(7);$("#times_list").html(appearanceTab(mapData.appearances[b])),$("#times_list").show()}function closeTimes(){$("#times_list").hide(),detailsPersist=!1}function addListeners(a){return a.addListener("click",function(){showTimes(a),detailsPersist=!0}),a.addListener("mouseover",function(){showTimes(a)}),a.addListener("mouseout",function(){detailsPersist||$("#times_list").hide()}),a}function initMap(){map=new google.maps.Map(document.getElementById("location_map"),{zoom:16,center:{lat:centerLat,lng:centerLng},fullscreenControl:!1,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl"]}});var a=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",a);var b=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",b);var c=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",c);var d=new google.maps.StyledMapType(pGoStyle,{name:"PokemonGo"});map.mapTypes.set("style_pgo",d);var e=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",e);var f=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",f);var g=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"PokemonGo (No Labels)"});map.mapTypes.set("style_pgo_nl",g),map.addListener("maptypeid_changed",function(a){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),google.maps.event.addListener(map,"idle",updateMap),mapLoaded=!0,google.maps.event.addListener(map,"zoom_changed",function(){redrawAppearances(mapData.appearances)})}function resetMap(){$.each(mapData.appearances,function(a,b){mapData.appearances[a].marker.setMap(null),delete mapData.appearances[a]}),heatmapPoints=[],heatmapNumPoints=0,heatmap&&heatmap.setMap(null),lastappearance=0}function showOverlay(a){return mapLoaded||initMap(),resetMap(),pokemonid=a,$("#location_details").show(),location.hash="overlay_"+pokemonid,updateDetails(),detailInterval=window.setInterval(updateDetails,5e3),!1}function closeOverlay(){return $("#location_details").hide(),window.clearInterval(detailInterval),closeTimes(),location.hash="",!1}function processAppearance(a,b){var c=new Date(b.disappear_time);c=c.getHours()+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2)+" "+c.getDate()+" "+monthArray[c.getMonth()]+" "+c.getFullYear();var d=b.latitude.toFixed(7)+"_"+b.longitude.toFixed(7);d in mapData.appearances?(mapData.appearances[d].count++,mapData.appearances[d].times.push(c)):(b.marker&&b.marker.setMap(null),b.count=1,b.times=[c],b.uuid=d,b.marker=setupPokemonMarker(b,!0),mapData.appearances[b.uuid]=b),heatmapPoints.push(new google.maps.LatLng(b.latitude,b.longitude)),lastappearance=Math.max(lastappearance,b.disappear_time)}function redrawAppearances(a){$.each(a,function(b,c){var d=a[b];if(!d.hidden){var e=setupPokemonMarker(d,!0);d.marker.setMap(null),a[b].marker=e}})}function appearanceTab(a){var b="";return $.each(a.times,function(a,c){b='<div class="row'+a%2+'">'+c+"</div>"+b}),'<div>\n                <a href="javascript:closeTimes();">Close this tab</a>\n            </div>\n            <div class="row1">\n                <strong>Lat:</strong> '+a.latitude.toFixed(7)+'\n            </div>\n            <div class="row0">\n                <strong>Long:</strong> '+a.longitude.toFixed(7)+'\n            </div>\n            <div class="row1">\n              <strong>Appearances:</strong> '+a.count.toLocaleString()+'\n            </div>\n            <div class="row0"><strong>Times:</strong></div>\n            <div>\n                '+b+"\n            </div>"}function updateDetails(){loadDetails().done(function(a){$.each(a.appearances,processAppearance),heatmapNumPoints!==heatmapPoints.length&&(heatmap&&heatmap.setMap(null),heatmap=new google.maps.visualization.HeatmapLayer({data:heatmapPoints,map:map,radius:50}),heatmapNumPoints=heatmapPoints.length)})}var monthArray=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],rawDataIsLoading=!1,totalPokemon=151;updateMap();var detailsLoading=!1,detailInterval=null,lastappearance=1,pokemonid=0,mapLoaded=!1,detailsPersist=!1,map=null,heatmap=null,heatmapNumPoints=-1,heatmapPoints=[];mapData.appearances={},location.href.match(/overlay_[0-9]+/g)&&showOverlay(location.href.replace(/^.*overlay_([0-9]+).*$/,"$1"));
//# sourceMappingURL=statistics.min.js.map